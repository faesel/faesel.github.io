<!DOCTYPE html><!--8T5i3JDkrsj5342kUJ4OR--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/logo-small.png"/><link rel="preload" as="image" href="https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png"/><link rel="stylesheet" href="/_next/static/chunks/19d110f125a6a880.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/chunks/007625c7813019e4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/cb2f3fb82496690c.js"/><script src="/_next/static/chunks/9a513a8c4dabec14.js" async=""></script><script src="/_next/static/chunks/0170781cb8f4ab8a.js" async=""></script><script src="/_next/static/chunks/090d87534b29d001.js" async=""></script><script src="/_next/static/chunks/turbopack-c66c9081754a27c6.js" async=""></script><script src="/_next/static/chunks/3524fbacef1ef8c0.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/708205fa81a1891d.js" async=""></script><link rel="preload" href="/_next/static/chunks/578ca6ed020117e9.css" as="style"/><title>Adding environments to ASP.NET Core with React.js SPA | Tech Blog</title><meta name="description" content="Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It&#x27;s one of the templates you get by default with dotnet a"/><meta name="author" content="Your Name"/><meta name="keywords" content="react,spa,asp.net,dotnet core,environments,env-cmd,shx,template,msbuild,.env"/><meta property="og:title" content="Adding environments to ASP.NET Core with React.js SPA"/><meta property="og:description" content="Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It&#x27;s one of the templates you get by default with dotnet a"/><meta property="og:image" content="https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-01-19T00:00+00:00"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@yourusername"/><meta name="twitter:creator" content="@yourusername"/><meta name="twitter:title" content="Adding environments to ASP.NET Core with React.js SPA"/><meta name="twitter:description" content="Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It&#x27;s one of the templates you get by default with dotnet a"/><meta name="twitter:image" content="https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"Tech Blog","url":"https://yourblog.com","logo":{"@type":"ImageObject","url":"https://yourblog.com/images/logo.png"},"sameAs":["https://github.com/yourusername","https://linkedin.com/in/yourusername"]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Tech Blog","url":"https://yourblog.com","description":"A modern tech blog exploring technology, coding, and digital innovation","publisher":{"@type":"Organization","name":"Tech Blog","url":"https://yourblog.com"}}</script><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><a href="#main-content" class="skip-to-content">Skip to content</a><header class="Header-module__hBw1pG__header"><div class="Header-module__hBw1pG__container"><a class="Header-module__hBw1pG__logo" aria-label="Home" href="/"><img alt="Logo" width="40" height="40" decoding="async" data-nimg="1" class="Header-module__hBw1pG__logoImage" style="color:transparent" src="/images/logo-small.png"/></a><button class="Header-module__hBw1pG__mobileMenuButton" aria-label="Toggle menu" aria-expanded="false">‚ò∞</button><nav class="Header-module__hBw1pG__nav " role="navigation" aria-label="Main navigation"><a class="Header-module__hBw1pG__navLink " href="/">Home</a><a class="Header-module__hBw1pG__navLink " href="/blog">Blog</a><a class="Header-module__hBw1pG__navLink " href="/projects">Projects</a><a class="Header-module__hBw1pG__navLink " href="/about">About</a><a class="Header-module__hBw1pG__navLink " href="/contact">Contact</a></nav></div></header><main id="main-content" style="min-height:70vh"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Adding environments to ASP.NET Core with React.js SPA","description":"Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It's one of the templates you get by default with dotnet a","image":"https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png","datePublished":"2021-01-19T00:00+00:00","dateModified":"2021-01-19T00:00+00:00","author":{"@type":"Person","name":"Your Name","url":"https://yourblog.com/about"},"publisher":{"@type":"Organization","name":"Tech Blog","url":"https://yourblog.com","logo":{"@type":"ImageObject","url":"https://yourblog.com/images/logo.png"}},"keywords":"react, spa, asp.net, dotnet core, environments, env-cmd, shx, template, msbuild, .env","url":"https://yourblog.com/blog/aspnet-core-react-spa-adding-environments","mainEntityOfPage":{"@type":"WebPage","@id":"https://yourblog.com/blog/aspnet-core-react-spa-adding-environments"}}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://yourblog.com"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://yourblog.com/blog"},{"@type":"ListItem","position":3,"name":"Adding environments to ASP.NET Core with React.js SPA","item":"https://yourblog.com/blog/aspnet-core-react-spa-adding-environments"}]}</script><article class="page-module__dgei_G__article"><a class="page-module__dgei_G__backLink" href="/blog">‚Üê Back to Blog</a><header class="page-module__dgei_G__header"><h1 class="page-module__dgei_G__title">Adding environments to ASP.NET Core with React.js SPA</h1><div class="page-module__dgei_G__meta"><time class="page-module__dgei_G__date" dateTime="2021-01-19T00:00+00:00">üìÖ <!-- -->January 19, 2021</time></div><div class="page-module__dgei_G__tags"><span class="page-module__dgei_G__tag">react</span><span class="page-module__dgei_G__tag">spa</span><span class="page-module__dgei_G__tag">asp.net</span><span class="page-module__dgei_G__tag">dotnet core</span><span class="page-module__dgei_G__tag">environments</span><span class="page-module__dgei_G__tag">env-cmd</span><span class="page-module__dgei_G__tag">shx</span><span class="page-module__dgei_G__tag">template</span><span class="page-module__dgei_G__tag">msbuild</span><span class="page-module__dgei_G__tag">.env</span></div></header><div class="page-module__dgei_G__heroImage"><img alt="Adding environments to ASP.NET Core with React.js SPA" decoding="async" data-nimg="fill" class="page-module__dgei_G__heroImageImg" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png"/></div><div class="page-module__dgei_G__content"><p>Recently I started working on a project that was created from the <strong>ASP.NET SPA template for react</strong>. It&#39;s one of the templates you get by default with dotnet and can be created by running <code>dotnet new react</code>.</p>
<p>The template creates a dotnet webapp which is designed to be an API backend and links it with a react project to power the UI. When running the project from dotnet, static files are built from the react project and served up.</p>
<p>In terms of running the application with different environments, the dotnet perspective is fairly straight forward as we can simply use the environment variable <code>ASPNETCORE_ENVIRONMENT</code>. But the question is how do we pass this variable to the SPA so that we can shift between different environments?</p>
<p>Having trawled the internet I didn&#39;t see any examples, so I decided to create my own!</p>
<h1>Understanding the ASP.NET spa template üîç</h1>
<p>Let&#39;s begin by creating a boilerplate solution with <code>dotnet new react</code>. Once the solution is created we end up with a backend API with a <code>WeatherForecastController</code>, and a front end app located in the <code>ClientApp</code> folder.</p>
<p><img src="//images.ctfassets.net/wjg1udsw901v/65iH6wUZxUc6JSNON5gWTK/a704de8ffa2dd0d4a33eef19ebf92390/folder-structure.png" alt="Dotnet SPA Folder Structure"></p>
<p>Since this is an integrated spa, from the root of the project we are able to <code>dotnet run</code> and spin up not only the dotnet project but also the react spa.</p>
<h2>Client App</h2>
<p>The client app itself is in a completely segregated app, there&#39;s nothing special added here to make it all connect up. All your standard commands to <code>npm install/build</code> are all available to you. In fact, the template has been build based on the implementation of <code>create-react-app</code>.</p>
<p>You can also start up the project from here with <code>npm run start</code> command which will spin up a development server <strong>independent of your backend code</strong>. The execution and configuration is handled for us using <code>react-scripts</code> which was designed to help set up react projects without stress, featuring things like hot module reloading, deployment builds etc ... all standard-issue so far. So you get these npm scripts setup for you,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">  &quot;scripts&quot;: {</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">    &quot;start&quot;: &quot;rimraf ./<span class="hljs-keyword">build</span> &amp;&amp; react-scripts <span class="hljs-keyword">start</span><span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">    &quot;</span><span class="hljs-keyword">build</span><span class="hljs-string">&quot;: &quot;</span>react-scripts <span class="hljs-keyword">build</span><span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">    &quot;</span>test<span class="hljs-string">&quot;: &quot;</span>cross-env CI=<span class="hljs-literal">true</span> react-scripts test --env=jsdom<span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content">    &quot;</span>eject<span class="hljs-string">&quot;: &quot;</span>react-scripts eject<span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content">    &quot;</span>lint<span class="hljs-string">&quot;: &quot;</span>eslint ./src/<span class="hljs-string">&quot;</span></span>
<span class="code-line"><span class="line-number">7</span><span class="line-content">  },</span></span></span></code></pre><h2>Startup Class</h2>
<p>The glue that connects the backend to the frontend can be found in the <code>Startup.cs</code> class. Working from top down the first code block of interest is within the <em>ConfigureServices</em> function,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">services.AddSpaStaticFiles(configuration <span class="hljs-operator">=</span>&gt;</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">{</span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">  configuration.RootPath <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ClientApp/build&quot;</span><span class="hljs-comment">;</span></span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">})<span class="hljs-comment">;</span></span></span></code></pre><p>This block essentially tells your dotnet app where to find the static resources (production builds) of your spa within its bin folder. So running the command <code>dotnet publish --configuration Release</code> creates a <strong>ClientApp/Build</strong> folder with a production optimised (ie npm run build) version of our SPA, the root path simply points to this.</p>
<p><img src="//images.ctfassets.net/wjg1udsw901v/4tIwYVA6pYWrGctHAzMXHT/d0836b601480a1962a7693bf4cd8b653/spa-build-folder.png" alt="clientapp-build-folder"></p>
<p>The next block to notice is in the <em>Configure</em> function,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">app.UseEndpoints(<span class="hljs-function"><span class="hljs-params">endpoints</span> =&gt;</span></span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">{</span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">    endpoints.MapControllerRoute(</span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">        name: <span class="hljs-string">&quot;default&quot;</span>,</span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content">        <span class="hljs-attr">pattern</span>: <span class="hljs-string">&quot;{controller}/{action=Index}/{id?}&quot;</span>);</span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content">});</span></span>
<span class="code-line"><span class="line-number">7</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">8</span><span class="line-content">app.UseSpa(<span class="hljs-function"><span class="hljs-params">spa</span> =&gt;</span></span></span>
<span class="code-line"><span class="line-number">9</span><span class="line-content">{</span></span>
<span class="code-line"><span class="line-number">10</span><span class="line-content">    spa.Options.SourcePath = <span class="hljs-string">&quot;ClientApp&quot;</span>;</span></span>
<span class="code-line"><span class="line-number">11</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">12</span><span class="line-content">    <span class="hljs-keyword">if</span> (env.IsDevelopment())</span></span>
<span class="code-line"><span class="line-number">13</span><span class="line-content">    {</span></span>
<span class="code-line"><span class="line-number">14</span><span class="line-content">        spa.UseReactDevelopmentServer(npmScript: <span class="hljs-string">&quot;start&quot;</span>);</span></span>
<span class="code-line"><span class="line-number">15</span><span class="line-content">    }</span></span>
<span class="code-line"><span class="line-number">16</span><span class="line-content">});</span></span></code></pre><p>There are two things that are happening here, the first is that we have dotnet server side routing connected up (with app.UseEndpoints() middleware), this means that upon receiving a HTTP request server-side routing will always take priority over client-side routing. If server-side routes fall through without matching an endpoint, we use the app.UseSpa() middleware to redirect all requests to the default page (which is your index.html file triggering the spa to load).</p>
<p>The next point is that from here we can also configure the location of our client-side source code, and the command we need to use to run our react spa as a development server when debugging.</p>
<h2>MSBuild &amp; Running NPM Commands</h2>
<p>The remaining magic is all located in the .csproj file we got 2 core components here the first is the Debug target,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content"><span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">&quot;DebugEnsureNodeEnv&quot;</span> <span class="hljs-attr">BeforeTargets</span>=<span class="hljs-string">&quot;Build&quot;</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Debug&#x27; And !Exists(&#x27;$(SpaRoot)node_modules&#x27;) &quot;</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">  <span class="hljs-comment">&lt;!-- Ensure Node.js is installed --&gt;</span></span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">Exec</span> <span class="hljs-attr">Command</span>=<span class="hljs-string">&quot;node --version&quot;</span> <span class="hljs-attr">ContinueOnError</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">    <span class="hljs-tag">&lt;<span class="hljs-name">Output</span> <span class="hljs-attr">TaskParameter</span>=<span class="hljs-string">&quot;ExitCode&quot;</span> <span class="hljs-attr">PropertyName</span>=<span class="hljs-string">&quot;ErrorCode&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content">  <span class="hljs-tag">&lt;/<span class="hljs-name">Exec</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">Error</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">&quot;&#x27;$(ErrorCode)&#x27; != &#x27;0&#x27;&quot;</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">&quot;Node.js is required to build and run this project. To continue, please install Node.js from https://nodejs.org/, and then restart your command prompt or IDE.&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">7</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">Importance</span>=<span class="hljs-string">&quot;high&quot;</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">&quot;Restoring dependencies using &#x27;npm&#x27;. This may take several minutes...&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">8</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">Exec</span> <span class="hljs-attr">WorkingDirectory</span>=<span class="hljs-string">&quot;$(SpaRoot)&quot;</span> <span class="hljs-attr">Command</span>=<span class="hljs-string">&quot;npm install&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">9</span><span class="line-content"><span class="hljs-tag">&lt;/<span class="hljs-name">Target</span>&gt;</span></span></span></code></pre><p>This chunky block of code runs an <code>npm install</code> command before building your dotnet application. It also features a nice check to ensure you got Node.js installed (I guess for the backend people üòÅ). It does this with the <code>&lt;Exec WorkingDirectory=&quot;$(SpaRoot)&quot; Command=&quot;npm install&quot; /&gt;</code> command runner (note SpaRoot is defined a the top as a static property pointing to *<em>ClientApp*</em>).</p>
<p>The second part is the publish target,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content"><span class="hljs-tag">&lt;<span class="hljs-name">Target</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">&quot;PublishRunWebpack&quot;</span> <span class="hljs-attr">AfterTargets</span>=<span class="hljs-string">&quot;ComputeFilesToPublish&quot;</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">  <span class="hljs-comment">&lt;!-- As part of publishing, ensure the JS resources are freshly built in production mode --&gt;</span></span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">Exec</span> <span class="hljs-attr">WorkingDirectory</span>=<span class="hljs-string">&quot;$(SpaRoot)&quot;</span> <span class="hljs-attr">Command</span>=<span class="hljs-string">&quot;npm install&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">Exec</span> <span class="hljs-attr">WorkingDirectory</span>=<span class="hljs-string">&quot;$(SpaRoot)&quot;</span> <span class="hljs-attr">Command</span>=<span class="hljs-string">&quot;npm run build&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content">  <span class="hljs-comment">&lt;!-- Include the newly-built files in the publish output --&gt;</span></span></span>
<span class="code-line"><span class="line-number">7</span><span class="line-content">  <span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">8</span><span class="line-content">    <span class="hljs-tag">&lt;<span class="hljs-name">DistFiles</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;$(SpaRoot)build\**&quot;</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">9</span><span class="line-content">    <span class="hljs-tag">&lt;<span class="hljs-name">ResolvedFileToPublish</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">&quot;@(DistFiles-&gt;&#x27;%(FullPath)&#x27;)&quot;</span> <span class="hljs-attr">Exclude</span>=<span class="hljs-string">&quot;@(ResolvedFileToPublish)&quot;</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">10</span><span class="line-content">      <span class="hljs-tag">&lt;<span class="hljs-name">RelativePath</span>&gt;</span>%(DistFiles.Identity)<span class="hljs-tag">&lt;/<span class="hljs-name">RelativePath</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">11</span><span class="line-content">      <span class="hljs-tag">&lt;<span class="hljs-name">CopyToPublishDirectory</span>&gt;</span>PreserveNewest<span class="hljs-tag">&lt;/<span class="hljs-name">CopyToPublishDirectory</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">12</span><span class="line-content">      <span class="hljs-tag">&lt;<span class="hljs-name">ExcludeFromSingleFile</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">ExcludeFromSingleFile</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">13</span><span class="line-content">    <span class="hljs-tag">&lt;/<span class="hljs-name">ResolvedFileToPublish</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">14</span><span class="line-content">  <span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">15</span><span class="line-content"><span class="hljs-tag">&lt;/<span class="hljs-name">Target</span>&gt;</span></span></span></code></pre><p>Again fairly similar concept running a publish first installs dependencies then builds the project. The build artefacts get created in the <strong>ClientApp\build</strong> folder. The item group block then ensures the build assets are included in your <strong>bin\ClientApp\build</strong> folder.</p>
<h2>Summary</h2>
<p>So to summarise, when running in debug mode</p>
<ol>
<li>We npm install dependencies</li>
<li>Build and run the dotnet app</li>
<li>Run an npm development server</li>
<li>Begin routing all calls to the backend, and where it fails to the default client page.</li>
</ol>
<p>In the case of a published application</p>
<ol>
<li>We create a published version of the dotnet application</li>
<li>We npm install dependencies</li>
<li>We create a production build of the spa in the folder <strong>ClientApp\build</strong></li>
<li>Static files from the spa are included in the output</li>
<li>Running the application now has a packaged version of the spa its static files are served up upon running the backend.</li>
</ol>
<p>This is all well and great so far... but the react app gets pre built.. what if we need to run it as part of a different environment? Currently, it&#39;s all running off a single <code>.env</code> file!</p>
<h1>Adding environments üÜï</h1>
<p>Below is my solution for getting environments running across the stack, it also conforms to the dev-ops ethos of,</p>
<blockquote>
<p>Build once and deploy many times.</p>
</blockquote>
<h2>Install the dependencies</h2>
<p>To being adding environments we first need to ensure our npm app can support it. For this, we will use the well know <a href="https://www.npmjs.com/package/env-cmd">env-cmd</a>. </p>
<p>We will also be needing something to manipulate the build folders generated by react-scripts. Since all operating systems are equipped with CLI commands to rename/remove files we don&#39;t need anything special to do this. However, because these commands differ from one operating system to the next, it&#39;s always a good practice to use something like <a href="https://www.npmjs.com/package/shx">shx</a> to ensure it works cross-platform.</p>
<p>So let&#39;s start with running the install command in the ClientApp folder,</p>
<p><code>npm install env-cmd shx --save-dev</code></p>
<h2>Add your environment files</h2>
<p>Next let&#39;s start creating some environment files, the file structure should look something like this, with the .env file containing settings shared across all the environments:</p>
<ul>
<li>.env</li>
<li>.env.staging</li>
<li>.env.production</li>
</ul>
<p>Any key on these files need to be prefixed with <code>REACT_APP_</code> this is a safety feature build in,</p>
<blockquote>
<p>You must create custom environment variables beginning with REACT_APP_. Any other variables except NODE_ENV will be ignored to avoid accidentally exposing a private key on the machine that could have the same name.</p>
</blockquote>
<p>For now, let&#39;s add just add an environment variable that tells us which environment we are in. Do this for both production and staging .env files.</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content"><span class="hljs-attr">REACT_APP_ENV</span>=<span class="hljs-string">&#x27;production&#x27;</span></span></span></code></pre><p>To show our environment on the page lets also create a <em>config.js</em> file, that accesses the environment variable.</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content"><span class="hljs-keyword">export</span> <span class="hljs-type">const</span> config = {</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">    ENVIRONMENT: process.env.REACT_APP_ENV </span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">};</span></span></code></pre><p>And finally output it to the page,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Container</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reactstrap&#x27;</span>;</span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NavMenu</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./NavMenu&#x27;</span>;</span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content"><span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../config&#x27;</span>;</span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> {</span></span>
<span class="code-line"><span class="line-number">7</span><span class="line-content">  <span class="hljs-keyword">static</span> displayName = <span class="hljs-title class_">Layout</span>.<span class="hljs-property">name</span>;</span></span>
<span class="code-line"><span class="line-number">8</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">9</span><span class="line-content">  <span class="hljs-title function_">render</span> () {</span></span>
<span class="code-line"><span class="line-number">10</span><span class="line-content">    <span class="hljs-keyword">return</span> (</span></span>
<span class="code-line"><span class="line-number">11</span><span class="line-content">      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">12</span><span class="line-content">        {config.ENVIRONMENT}</span></span>
<span class="code-line"><span class="line-number">13</span><span class="line-content">        <span class="hljs-tag">&lt;<span class="hljs-name">NavMenu</span> /&gt;</span></span></span>
<span class="code-line"><span class="line-number">14</span><span class="line-content">        <span class="hljs-tag">&lt;<span class="hljs-name">Container</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">15</span><span class="line-content">          {this.props.children}</span></span>
<span class="code-line"><span class="line-number">16</span><span class="line-content">        <span class="hljs-tag">&lt;/<span class="hljs-name">Container</span>&gt;</span></span></span>
<span class="code-line"><span class="line-number">17</span><span class="line-content">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span></span>
<span class="code-line"><span class="line-number">18</span><span class="line-content">    );</span></span>
<span class="code-line"><span class="line-number">19</span><span class="line-content">  }</span></span>
<span class="code-line"><span class="line-number">20</span><span class="line-content">}</span></span>
<span class="code-line"><span class="line-number">21</span><span class="line-content"></span></span></code></pre><h2>Add your build scripts</h2>
<p>Build scripts are now needed to trigger the environments, we need to make the following amends to the npm scripts section,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">  &quot;scripts&quot;: {</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">    &quot;<span class="hljs-keyword">build</span>:staging<span class="hljs-string">&quot;: &quot;</span>env-cmd -f .env.staging react-scripts <span class="hljs-keyword">build</span> &amp;&amp; shx rm -rf staging &amp;&amp; shx cp -r <span class="hljs-keyword">build</span> staging<span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">    &quot;</span><span class="hljs-keyword">build</span>:production<span class="hljs-string">&quot;: &quot;</span>env-cmd -f .env.production react-scripts <span class="hljs-keyword">build</span> &amp;&amp; shx rm -rf production &amp;&amp; shx cp -r <span class="hljs-keyword">build</span> production<span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">    &quot;</span><span class="hljs-keyword">start</span>:staging<span class="hljs-string">&quot;: &quot;</span>rimraf ./<span class="hljs-keyword">build</span> &amp;&amp; env-cmd -f .env.staging react-scripts <span class="hljs-keyword">start</span><span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content">    &quot;</span><span class="hljs-keyword">start</span>:production<span class="hljs-string">&quot;: &quot;</span>rimraf ./<span class="hljs-keyword">build</span> &amp;&amp; env-cmd -f .env.production react-scripts <span class="hljs-keyword">start</span><span class="hljs-string">&quot;,</span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content">  }</span></span></span></code></pre><p>The scripts prefixed with <em>build</em> are using env-cmd with its respective environment file to create a production build of the app. The shx part is then firstly removing the folder staging/production then copying the <em>build</em> files react-script creates into an environment specific folder.</p>
<p>Similarly the scripts prefixed with <em>start</em> run the app using a certain environment. Note if your trying to run this from the dotnet app, you will need to change the Startup.cs &gt; UseReactDevelopmentServer function to,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">spa<span class="hljs-selector-class">.UseReactDevelopmentServer</span>(npmScript: <span class="hljs-string">&quot;start:production&quot;</span>);</span></span></code></pre><p>Now that this is set up, running the app should show the environment variables.</p>
<h2>Modifying your .csproj</h2>
<p>The next step is to get this working with <code>dotnet publish</code>! To do this we need to modify the <strong>PublishRunWebpack</strong> target in the .csproj file to,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">&lt;Target Name<span class="hljs-operator">=</span><span class="hljs-string">&quot;PublishRunWebpack&quot;</span> AfterTargets<span class="hljs-operator">=</span><span class="hljs-string">&quot;ComputeFilesToPublish&quot;</span>&gt;</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">  &lt;Exec WorkingDirectory<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)&quot;</span> Command<span class="hljs-operator">=</span><span class="hljs-string">&quot;npm install&quot;</span>/&gt;</span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">4</span><span class="line-content">  &lt;Message Importance<span class="hljs-operator">=</span><span class="hljs-string">&quot;high&quot;</span> Text<span class="hljs-operator">=</span><span class="hljs-string">&quot;Started building staging version of the spa ...&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Release&#x27; &quot;</span>/&gt;</span></span>
<span class="code-line"><span class="line-number">5</span><span class="line-content">  &lt;Exec WorkingDirectory<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)&quot;</span> Command<span class="hljs-operator">=</span><span class="hljs-string">&quot;npm run build:staging&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Release&#x27; &quot;</span>/&gt;</span></span>
<span class="code-line"><span class="line-number">6</span><span class="line-content">  &lt;Message Importance<span class="hljs-operator">=</span><span class="hljs-string">&quot;high&quot;</span> Text<span class="hljs-operator">=</span><span class="hljs-string">&quot;Started building production version of the spa ...&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Release&#x27; &quot;</span>/&gt;</span></span>
<span class="code-line"><span class="line-number">7</span><span class="line-content">  &lt;Exec WorkingDirectory<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)&quot;</span> Command<span class="hljs-operator">=</span><span class="hljs-string">&quot;npm run build:production&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Release&#x27; &quot;</span>/&gt;</span></span>
<span class="code-line"><span class="line-number">8</span><span class="line-content"></span></span>
<span class="code-line"><span class="line-number">9</span><span class="line-content">  &lt;Exec WorkingDirectory<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)&quot;</span> Command<span class="hljs-operator">=</span><span class="hljs-string">&quot;npm run build&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Debug&#x27; &quot;</span> /&gt;</span></span>
<span class="code-line"><span class="line-number">10</span><span class="line-content">  &lt;ItemGroup&gt;</span></span>
<span class="code-line"><span class="line-number">11</span><span class="line-content">    &lt;DistFiles Include<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)build\**&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Debug&#x27; &quot;</span> /&gt;</span></span>
<span class="code-line"><span class="line-number">12</span><span class="line-content">    &lt;DistFiles Include<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)staging\**&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Release&#x27; &quot;</span> /&gt;</span></span>
<span class="code-line"><span class="line-number">13</span><span class="line-content">    &lt;DistFiles Include<span class="hljs-operator">=</span><span class="hljs-string">&quot;$(SpaRoot)production\**&quot;</span> Condition<span class="hljs-operator">=</span><span class="hljs-string">&quot; &#x27;$(Configuration)&#x27; == &#x27;Release&#x27; &quot;</span> /&gt;</span></span>
<span class="code-line"><span class="line-number">14</span><span class="line-content">    &lt;ResolvedFileToPublish Include<span class="hljs-operator">=</span><span class="hljs-string">&quot;@(DistFiles-&gt;&#x27;%(FullPath)&#x27;)&quot;</span> Exclude<span class="hljs-operator">=</span><span class="hljs-string">&quot;@(ResolvedFileToPublish)&quot;</span>&gt;</span></span>
<span class="code-line"><span class="line-number">15</span><span class="line-content">      &lt;RelativePath&gt;%(DistFiles.Identity)&lt;/RelativePath&gt;</span></span>
<span class="code-line"><span class="line-number">16</span><span class="line-content">      &lt;CopyToPublishDirectory&gt;PreserveNewest&lt;/CopyToPublishDirectory&gt;</span></span>
<span class="code-line"><span class="line-number">17</span><span class="line-content">      &lt;ExcludeFromSingleFile&gt;true&lt;/ExcludeFromSingleFile&gt;</span></span>
<span class="code-line"><span class="line-number">18</span><span class="line-content">    &lt;/ResolvedFileToPublish&gt;</span></span>
<span class="code-line"><span class="line-number">19</span><span class="line-content">  &lt;/ItemGroup&gt;</span></span>
<span class="code-line"><span class="line-number">20</span><span class="line-content">&lt;/Target&gt;</span></span></code></pre><p>To summarise what&#39;s happening here, when building in debug mode we are continuing to use the <code>npm run build</code> command to create a production build and the spa files get stored in the build folder <code>$(SpaRoot)build\**</code>. The output looks like this:</p>
<ul>
<li>bin<ul>
<li>Release<ul>
<li>publish<ul>
<li>ClientApp<ul>
<li>build<br>-spa files go here!</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>However in release mode we now create two versions of the spa (one for each environment) using out new npm environment builds, <code>npm run build:staging</code> and  <code>npm run build:production</code>. The builds also get moved to their corresponding folders.</p>
<ul>
<li>bin<ul>
<li>Release<ul>
<li>publish<ul>
<li>ClientApp<ul>
<li>staging<ul>
<li>staging spa files go here!</li>
</ul>
</li>
<li>production<ul>
<li>production spa files go here!</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Once thats setup you can test it out with <code>dotnet publish --configuration Release</code>, the build output should look something like this,</p>
<p><img src="//images.ctfassets.net/wjg1udsw901v/6gBCaZH5bJ6vaNW2wf8QPD/7b1fcf59b5a716760ebf49c95aaaab85/BuildExample.png" alt="build-output-spa"></p>
<h2>Modifying your startup.cs</h2>
<p>The final step is to modify your Startup.cs file to switch out which spa to use based on the environment variable,</p>
<pre><code class="hljs "><span class="code-line"><span class="line-number">1</span><span class="line-content">services.AddSpaStaticFiles(<span class="hljs-function"><span class="hljs-params">configuration</span> =&gt;</span> configuration.RootPath = WebHostEnvironment.IsDevelopment()</span></span>
<span class="code-line"><span class="line-number">2</span><span class="line-content">                ? <span class="hljs-string">&quot;ClientApp/build&quot;</span></span></span>
<span class="code-line"><span class="line-number">3</span><span class="line-content">                : $<span class="hljs-string">&quot;ClientApp/{WebHostEnvironment.EnvironmentName}&quot;</span>);</span></span></code></pre><h1>How to deploy üöÄ</h1>
<p>Deployment is now a simple case of running <code>dotnet publish --configuration Release</code>, once the published artefacts are deployed the app can now take its environment and run the appropriate spa. Build once and deploy anywhere!</p>
</div></article><!--$--><!--/$--></main><footer class="Footer-module__S6Hkya__footer"><div class="Footer-module__S6Hkya__container"><div class="Footer-module__S6Hkya__content"><nav class="Footer-module__S6Hkya__links" aria-label="Footer navigation"><a class="Footer-module__S6Hkya__link" href="/blog">Blog</a><a class="Footer-module__S6Hkya__link" href="/projects">Projects</a><a class="Footer-module__S6Hkya__link" href="/about">About</a><a class="Footer-module__S6Hkya__link" href="/contact">Contact</a></nav><p class="Footer-module__S6Hkya__copyright">¬© <!-- -->2026<!-- --> All rights reserved.</p></div></div></footer><script src="/_next/static/chunks/cb2f3fb82496690c.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[2971,[\"/_next/static/chunks/3524fbacef1ef8c0.js\"],\"default\"]\n3:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/708205fa81a1891d.js\"],\"default\"]\n4:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/708205fa81a1891d.js\"],\"default\"]\n5:I[22016,[\"/_next/static/chunks/3524fbacef1ef8c0.js\"],\"\"]\n7:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/708205fa81a1891d.js\"],\"OutletBoundary\"]\n8:\"$Sreact.suspense\"\na:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/708205fa81a1891d.js\"],\"ViewportBoundary\"]\nc:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/708205fa81a1891d.js\"],\"MetadataBoundary\"]\ne:I[68027,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/708205fa81a1891d.js\"],\"default\"]\n:HL[\"/_next/static/chunks/19d110f125a6a880.css\",\"style\"]\n:HL[\"/_next/static/chunks/007625c7813019e4.css\",\"style\"]\n:HL[\"/_next/static/chunks/578ca6ed020117e9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"8T5i3JDkrsj5342kUJ4OR\",\"c\":[\"\",\"blog\",\"aspnet-core-react-spa-adding-environments\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"aspnet-core-react-spa-adding-environments\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/19d110f125a6a880.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/3524fbacef1ef8c0.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"Tech Blog\\\",\\\"url\\\":\\\"https://yourblog.com\\\",\\\"logo\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"url\\\":\\\"https://yourblog.com/images/logo.png\\\"},\\\"sameAs\\\":[\\\"https://github.com/yourusername\\\",\\\"https://linkedin.com/in/yourusername\\\"]}\"}}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"WebSite\\\",\\\"name\\\":\\\"Tech Blog\\\",\\\"url\\\":\\\"https://yourblog.com\\\",\\\"description\\\":\\\"A modern tech blog exploring technology, coding, and digital innovation\\\",\\\"publisher\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"Tech Blog\\\",\\\"url\\\":\\\"https://yourblog.com\\\"}}\"}}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"#main-content\",\"className\":\"skip-to-content\",\"children\":\"Skip to content\"}],[\"$\",\"$L2\",null,{}],[\"$\",\"main\",null,{\"id\":\"main-content\",\"style\":{\"minHeight\":\"70vh\"},\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"not-found-module__HS70Aa__container\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"not-found-module__HS70Aa__title\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"not-found-module__HS70Aa__subtitle\",\"children\":\"Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"not-found-module__HS70Aa__message\",\"children\":\"Sorry, the page you're looking for doesn't exist.\"}],[\"$\",\"$L5\",null,{\"href\":\"/\",\"className\":\"not-found-module__HS70Aa__homeLink\",\"children\":\"Go Home\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/578ca6ed020117e9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"Footer-module__S6Hkya__footer\",\"children\":[\"$\",\"div\",null,{\"className\":\"Footer-module__S6Hkya__container\",\"children\":[\"$\",\"div\",null,{\"className\":\"Footer-module__S6Hkya__content\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"Footer-module__S6Hkya__links\",\"aria-label\":\"Footer navigation\",\"children\":[[\"$\",\"$L5\",null,{\"href\":\"/blog\",\"className\":\"Footer-module__S6Hkya__link\",\"children\":\"Blog\"}],[\"$\",\"$L5\",null,{\"href\":\"/projects\",\"className\":\"Footer-module__S6Hkya__link\",\"children\":\"Projects\"}],[\"$\",\"$L5\",null,{\"href\":\"/about\",\"className\":\"Footer-module__S6Hkya__link\",\"children\":\"About\"}],[\"$\",\"$L5\",null,{\"href\":\"/contact\",\"className\":\"Footer-module__S6Hkya__link\",\"children\":\"Contact\"}]]}],[\"$\",\"p\",null,{\"className\":\"Footer-module__S6Hkya__copyright\",\"children\":[\"¬© \",2026,\" All rights reserved.\"]}]]}]}]}]]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/007625c7813019e4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":[\"$\",\"$8\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@9\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$8\",null,{\"name\":\"Next.Metadata\",\"children\":\"$Ld\"}]}]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[5500,[\"/_next/static/chunks/3524fbacef1ef8c0.js\"],\"Image\"]\n9:null\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"title\",\"0\",{\"children\":\"Adding environments to ASP.NET Core with React.js SPA | Tech Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It's one of the templates you get by default with dotnet a\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Your Name\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"react,spa,asp.net,dotnet core,environments,env-cmd,shx,template,msbuild,.env\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"Adding environments to ASP.NET Core with React.js SPA\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It's one of the templates you get by default with dotnet a\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image\",\"content\":\"https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"8\",{\"property\":\"article:published_time\",\"content\":\"2021-01-19T00:00+00:00\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:site\",\"content\":\"@yourusername\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:creator\",\"content\":\"@yourusername\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:title\",\"content\":\"Adding environments to ASP.NET Core with React.js SPA\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:description\",\"content\":\"Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It's one of the templates you get by default with dotnet a\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:image\",\"content\":\"https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png\"}]]\n"])</script><script>self.__next_f.push([1,"f:T406,{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"Adding environments to ASP.NET Core with React.js SPA\",\"description\":\"Recently I started working on a project that was created from the **ASP.NET SPA template for react**. It's one of the templates you get by default with dotnet a\",\"image\":\"https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png\",\"datePublished\":\"2021-01-19T00:00+00:00\",\"dateModified\":\"2021-01-19T00:00+00:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Your Name\",\"url\":\"https://yourblog.com/about\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Tech Blog\",\"url\":\"https://yourblog.com\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https://yourblog.com/images/logo.png\"}},\"keywords\":\"react, spa, asp.net, dotnet core, environments, env-cmd, shx, template, msbuild, .env\",\"url\":\"https://yourblog.com/blog/aspnet-core-react-spa-adding-environments\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https://yourblog.com/blog/aspnet-core-react-spa-adding-environments\"}}11:T8b47,"])</script><script>self.__next_f.push([1,"\u003cp\u003eRecently I started working on a project that was created from the \u003cstrong\u003eASP.NET SPA template for react\u003c/strong\u003e. It\u0026#39;s one of the templates you get by default with dotnet and can be created by running \u003ccode\u003edotnet new react\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe template creates a dotnet webapp which is designed to be an API backend and links it with a react project to power the UI. When running the project from dotnet, static files are built from the react project and served up.\u003c/p\u003e\n\u003cp\u003eIn terms of running the application with different environments, the dotnet perspective is fairly straight forward as we can simply use the environment variable \u003ccode\u003eASPNETCORE_ENVIRONMENT\u003c/code\u003e. But the question is how do we pass this variable to the SPA so that we can shift between different environments?\u003c/p\u003e\n\u003cp\u003eHaving trawled the internet I didn\u0026#39;t see any examples, so I decided to create my own!\u003c/p\u003e\n\u003ch1\u003eUnderstanding the ASP.NET spa template üîç\u003c/h1\u003e\n\u003cp\u003eLet\u0026#39;s begin by creating a boilerplate solution with \u003ccode\u003edotnet new react\u003c/code\u003e. Once the solution is created we end up with a backend API with a \u003ccode\u003eWeatherForecastController\u003c/code\u003e, and a front end app located in the \u003ccode\u003eClientApp\u003c/code\u003e folder.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"//images.ctfassets.net/wjg1udsw901v/65iH6wUZxUc6JSNON5gWTK/a704de8ffa2dd0d4a33eef19ebf92390/folder-structure.png\" alt=\"Dotnet SPA Folder Structure\"\u003e\u003c/p\u003e\n\u003cp\u003eSince this is an integrated spa, from the root of the project we are able to \u003ccode\u003edotnet run\u003c/code\u003e and spin up not only the dotnet project but also the react spa.\u003c/p\u003e\n\u003ch2\u003eClient App\u003c/h2\u003e\n\u003cp\u003eThe client app itself is in a completely segregated app, there\u0026#39;s nothing special added here to make it all connect up. All your standard commands to \u003ccode\u003enpm install/build\u003c/code\u003e are all available to you. In fact, the template has been build based on the implementation of \u003ccode\u003ecreate-react-app\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eYou can also start up the project from here with \u003ccode\u003enpm run start\u003c/code\u003e command which will spin up a development server \u003cstrong\u003eindependent of your backend code\u003c/strong\u003e. The execution and configuration is handled for us using \u003ccode\u003ereact-scripts\u003c/code\u003e which was designed to help set up react projects without stress, featuring things like hot module reloading, deployment builds etc ... all standard-issue so far. So you get these npm scripts setup for you,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026quot;scripts\u0026quot;: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;start\u0026quot;: \u0026quot;rimraf ./\u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e \u0026amp;\u0026amp; react-scripts \u003cspan class=\"hljs-keyword\"\u003estart\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003ereact-scripts \u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003etest\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003ecross-env CI=\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e react-scripts test --env=jsdom\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003eeject\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003ereact-scripts eject\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003elint\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003eeslint ./src/\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e7\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  },\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eStartup Class\u003c/h2\u003e\n\u003cp\u003eThe glue that connects the backend to the frontend can be found in the \u003ccode\u003eStartup.cs\u003c/code\u003e class. Working from top down the first code block of interest is within the \u003cem\u003eConfigureServices\u003c/em\u003e function,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003eservices.AddSpaStaticFiles(configuration \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  configuration.RootPath \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;ClientApp/build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e})\u003cspan class=\"hljs-comment\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis block essentially tells your dotnet app where to find the static resources (production builds) of your spa within its bin folder. So running the command \u003ccode\u003edotnet publish --configuration Release\u003c/code\u003e creates a \u003cstrong\u003eClientApp/Build\u003c/strong\u003e folder with a production optimised (ie npm run build) version of our SPA, the root path simply points to this.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"//images.ctfassets.net/wjg1udsw901v/4tIwYVA6pYWrGctHAzMXHT/d0836b601480a1962a7693bf4cd8b653/spa-build-folder.png\" alt=\"clientapp-build-folder\"\u003e\u003c/p\u003e\n\u003cp\u003eThe next block to notice is in the \u003cem\u003eConfigure\u003c/em\u003e function,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003eapp.UseEndpoints(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eendpoints\u003c/span\u003e =\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    endpoints.MapControllerRoute(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        name: \u003cspan class=\"hljs-string\"\u003e\u0026quot;default\u0026quot;\u003c/span\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        \u003cspan class=\"hljs-attr\"\u003epattern\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;{controller}/{action=Index}/{id?}\u0026quot;\u003c/span\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e7\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e8\u003c/span\u003e\u003cspan class=\"line-content\"\u003eapp.UseSpa(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003espa\u003c/span\u003e =\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e9\u003c/span\u003e\u003cspan class=\"line-content\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e10\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    spa.Options.SourcePath = \u003cspan class=\"hljs-string\"\u003e\u0026quot;ClientApp\u0026quot;\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e11\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e12\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (env.IsDevelopment())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e13\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e14\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        spa.UseReactDevelopmentServer(npmScript: \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e15\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e16\u003c/span\u003e\u003cspan class=\"line-content\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThere are two things that are happening here, the first is that we have dotnet server side routing connected up (with app.UseEndpoints() middleware), this means that upon receiving a HTTP request server-side routing will always take priority over client-side routing. If server-side routes fall through without matching an endpoint, we use the app.UseSpa() middleware to redirect all requests to the default page (which is your index.html file triggering the spa to load).\u003c/p\u003e\n\u003cp\u003eThe next point is that from here we can also configure the location of our client-side source code, and the command we need to use to run our react spa as a development server when debugging.\u003c/p\u003e\n\u003ch2\u003eMSBuild \u0026amp; Running NPM Commands\u003c/h2\u003e\n\u003cp\u003eThe remaining magic is all located in the .csproj file we got 2 core components here the first is the Debug target,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eTarget\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;DebugEnsureNodeEnv\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eBeforeTargets\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Build\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eCondition\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Debug\u0026#x27; And !Exists(\u0026#x27;$(SpaRoot)node_modules\u0026#x27;) \u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- Ensure Node.js is installed --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eExec\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eCommand\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;node --version\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eContinueOnError\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;true\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eOutput\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eTaskParameter\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;ExitCode\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ePropertyName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;ErrorCode\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eExec\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eError\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eCondition\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026#x27;$(ErrorCode)\u0026#x27; != \u0026#x27;0\u0026#x27;\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eText\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Node.js is required to build and run this project. To continue, please install Node.js from https://nodejs.org/, and then restart your command prompt or IDE.\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e7\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eMessage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eImportance\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;high\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eText\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Restoring dependencies using \u0026#x27;npm\u0026#x27;. This may take several minutes...\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e8\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eExec\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eWorkingDirectory\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eCommand\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm install\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e9\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eTarget\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis chunky block of code runs an \u003ccode\u003enpm install\u003c/code\u003e command before building your dotnet application. It also features a nice check to ensure you got Node.js installed (I guess for the backend people üòÅ). It does this with the \u003ccode\u003e\u0026lt;Exec WorkingDirectory=\u0026quot;$(SpaRoot)\u0026quot; Command=\u0026quot;npm install\u0026quot; /\u0026gt;\u003c/code\u003e command runner (note SpaRoot is defined a the top as a static property pointing to *\u003cem\u003eClientApp*\u003c/em\u003e).\u003c/p\u003e\n\u003cp\u003eThe second part is the publish target,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eTarget\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;PublishRunWebpack\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eAfterTargets\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;ComputeFilesToPublish\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- As part of publishing, ensure the JS resources are freshly built in production mode --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eExec\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eWorkingDirectory\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eCommand\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm install\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eExec\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eWorkingDirectory\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eCommand\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm run build\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- Include the newly-built files in the publish output --\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e7\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eItemGroup\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e8\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eDistFiles\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eInclude\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)build\\**\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e9\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eResolvedFileToPublish\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eInclude\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;@(DistFiles-\u0026gt;\u0026#x27;%(FullPath)\u0026#x27;)\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eExclude\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;@(ResolvedFileToPublish)\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e10\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eRelativePath\u003c/span\u003e\u0026gt;\u003c/span\u003e%(DistFiles.Identity)\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eRelativePath\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e11\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eCopyToPublishDirectory\u003c/span\u003e\u0026gt;\u003c/span\u003ePreserveNewest\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eCopyToPublishDirectory\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e12\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eExcludeFromSingleFile\u003c/span\u003e\u0026gt;\u003c/span\u003etrue\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eExcludeFromSingleFile\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e13\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eResolvedFileToPublish\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e14\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eItemGroup\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e15\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eTarget\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAgain fairly similar concept running a publish first installs dependencies then builds the project. The build artefacts get created in the \u003cstrong\u003eClientApp\\build\u003c/strong\u003e folder. The item group block then ensures the build assets are included in your \u003cstrong\u003ebin\\ClientApp\\build\u003c/strong\u003e folder.\u003c/p\u003e\n\u003ch2\u003eSummary\u003c/h2\u003e\n\u003cp\u003eSo to summarise, when running in debug mode\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWe npm install dependencies\u003c/li\u003e\n\u003cli\u003eBuild and run the dotnet app\u003c/li\u003e\n\u003cli\u003eRun an npm development server\u003c/li\u003e\n\u003cli\u003eBegin routing all calls to the backend, and where it fails to the default client page.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIn the case of a published application\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWe create a published version of the dotnet application\u003c/li\u003e\n\u003cli\u003eWe npm install dependencies\u003c/li\u003e\n\u003cli\u003eWe create a production build of the spa in the folder \u003cstrong\u003eClientApp\\build\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eStatic files from the spa are included in the output\u003c/li\u003e\n\u003cli\u003eRunning the application now has a packaged version of the spa its static files are served up upon running the backend.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis is all well and great so far... but the react app gets pre built.. what if we need to run it as part of a different environment? Currently, it\u0026#39;s all running off a single \u003ccode\u003e.env\u003c/code\u003e file!\u003c/p\u003e\n\u003ch1\u003eAdding environments üÜï\u003c/h1\u003e\n\u003cp\u003eBelow is my solution for getting environments running across the stack, it also conforms to the dev-ops ethos of,\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBuild once and deploy many times.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003eInstall the dependencies\u003c/h2\u003e\n\u003cp\u003eTo being adding environments we first need to ensure our npm app can support it. For this, we will use the well know \u003ca href=\"https://www.npmjs.com/package/env-cmd\"\u003eenv-cmd\u003c/a\u003e. \u003c/p\u003e\n\u003cp\u003eWe will also be needing something to manipulate the build folders generated by react-scripts. Since all operating systems are equipped with CLI commands to rename/remove files we don\u0026#39;t need anything special to do this. However, because these commands differ from one operating system to the next, it\u0026#39;s always a good practice to use something like \u003ca href=\"https://www.npmjs.com/package/shx\"\u003eshx\u003c/a\u003e to ensure it works cross-platform.\u003c/p\u003e\n\u003cp\u003eSo let\u0026#39;s start with running the install command in the ClientApp folder,\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enpm install env-cmd shx --save-dev\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003eAdd your environment files\u003c/h2\u003e\n\u003cp\u003eNext let\u0026#39;s start creating some environment files, the file structure should look something like this, with the .env file containing settings shared across all the environments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e.env\u003c/li\u003e\n\u003cli\u003e.env.staging\u003c/li\u003e\n\u003cli\u003e.env.production\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAny key on these files need to be prefixed with \u003ccode\u003eREACT_APP_\u003c/code\u003e this is a safety feature build in,\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eYou must create custom environment variables beginning with REACT_APP_. Any other variables except NODE_ENV will be ignored to avoid accidentally exposing a private key on the machine that could have the same name.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eFor now, let\u0026#39;s add just add an environment variable that tells us which environment we are in. Do this for both production and staging .env files.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-attr\"\u003eREACT_APP_ENV\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026#x27;production\u0026#x27;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eTo show our environment on the page lets also create a \u003cem\u003econfig.js\u003c/em\u003e file, that accesses the environment variable.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e config = {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    ENVIRONMENT: process.env.REACT_APP_ENV \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e};\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAnd finally output it to the page,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e, { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;react\u0026#x27;\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eContainer\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;reactstrap\u0026#x27;\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eNavMenu\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./NavMenu\u0026#x27;\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { config } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../config\u0026#x27;\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eLayout\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eComponent\u003c/span\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e7\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e displayName = \u003cspan class=\"hljs-title class_\"\u003eLayout\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e8\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e9\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u003cspan class=\"hljs-title function_\"\u003erender\u003c/span\u003e () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e10\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e11\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e12\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        {config.ENVIRONMENT}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e13\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eNavMenu\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e14\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eContainer\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e15\u003c/span\u003e\u003cspan class=\"line-content\"\u003e          {this.props.children}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e16\u003c/span\u003e\u003cspan class=\"line-content\"\u003e        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eContainer\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e17\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e18\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e19\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e20\u003c/span\u003e\u003cspan class=\"line-content\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e21\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eAdd your build scripts\u003c/h2\u003e\n\u003cp\u003eBuild scripts are now needed to trigger the environments, we need to make the following amends to the npm scripts section,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026quot;scripts\u0026quot;: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e:staging\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003eenv-cmd -f .env.staging react-scripts \u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e \u0026amp;\u0026amp; shx rm -rf staging \u0026amp;\u0026amp; shx cp -r \u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e staging\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e:production\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003eenv-cmd -f .env.production react-scripts \u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e \u0026amp;\u0026amp; shx rm -rf production \u0026amp;\u0026amp; shx cp -r \u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e production\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003estart\u003c/span\u003e:staging\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003erimraf ./\u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e \u0026amp;\u0026amp; env-cmd -f .env.staging react-scripts \u003cspan class=\"hljs-keyword\"\u003estart\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003estart\u003c/span\u003e:production\u003cspan class=\"hljs-string\"\u003e\u0026quot;: \u0026quot;\u003c/span\u003erimraf ./\u003cspan class=\"hljs-keyword\"\u003ebuild\u003c/span\u003e \u0026amp;\u0026amp; env-cmd -f .env.production react-scripts \u003cspan class=\"hljs-keyword\"\u003estart\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe scripts prefixed with \u003cem\u003ebuild\u003c/em\u003e are using env-cmd with its respective environment file to create a production build of the app. The shx part is then firstly removing the folder staging/production then copying the \u003cem\u003ebuild\u003c/em\u003e files react-script creates into an environment specific folder.\u003c/p\u003e\n\u003cp\u003eSimilarly the scripts prefixed with \u003cem\u003estart\u003c/em\u003e run the app using a certain environment. Note if your trying to run this from the dotnet app, you will need to change the Startup.cs \u0026gt; UseReactDevelopmentServer function to,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003espa\u003cspan class=\"hljs-selector-class\"\u003e.UseReactDevelopmentServer\u003c/span\u003e(npmScript: \u003cspan class=\"hljs-string\"\u003e\u0026quot;start:production\u0026quot;\u003c/span\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow that this is set up, running the app should show the environment variables.\u003c/p\u003e\n\u003ch2\u003eModifying your .csproj\u003c/h2\u003e\n\u003cp\u003eThe next step is to get this working with \u003ccode\u003edotnet publish\u003c/code\u003e! To do this we need to modify the \u003cstrong\u003ePublishRunWebpack\u003c/strong\u003e target in the .csproj file to,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u0026lt;Target Name\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;PublishRunWebpack\u0026quot;\u003c/span\u003e AfterTargets\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;ComputeFilesToPublish\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;Exec WorkingDirectory\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e Command\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm install\u0026quot;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e4\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;Message Importance\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;high\u0026quot;\u003c/span\u003e Text\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;Started building staging version of the spa ...\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Release\u0026#x27; \u0026quot;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e5\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;Exec WorkingDirectory\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e Command\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm run build:staging\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Release\u0026#x27; \u0026quot;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e6\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;Message Importance\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;high\u0026quot;\u003c/span\u003e Text\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;Started building production version of the spa ...\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Release\u0026#x27; \u0026quot;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e7\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;Exec WorkingDirectory\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e Command\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm run build:production\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Release\u0026#x27; \u0026quot;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e8\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e9\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;Exec WorkingDirectory\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)\u0026quot;\u003c/span\u003e Command\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;npm run build\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Debug\u0026#x27; \u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e10\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e11\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026lt;DistFiles Include\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)build\\**\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Debug\u0026#x27; \u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e12\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026lt;DistFiles Include\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)staging\\**\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Release\u0026#x27; \u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e13\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026lt;DistFiles Include\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;$(SpaRoot)production\\**\u0026quot;\u003c/span\u003e Condition\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot; \u0026#x27;$(Configuration)\u0026#x27; == \u0026#x27;Release\u0026#x27; \u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e14\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026lt;ResolvedFileToPublish Include\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;@(DistFiles-\u0026gt;\u0026#x27;%(FullPath)\u0026#x27;)\u0026quot;\u003c/span\u003e Exclude\u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;@(ResolvedFileToPublish)\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e15\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u0026lt;RelativePath\u0026gt;%(DistFiles.Identity)\u0026lt;/RelativePath\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e16\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u0026lt;CopyToPublishDirectory\u0026gt;PreserveNewest\u0026lt;/CopyToPublishDirectory\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e17\u003c/span\u003e\u003cspan class=\"line-content\"\u003e      \u0026lt;ExcludeFromSingleFile\u0026gt;true\u0026lt;/ExcludeFromSingleFile\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e18\u003c/span\u003e\u003cspan class=\"line-content\"\u003e    \u0026lt;/ResolvedFileToPublish\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e19\u003c/span\u003e\u003cspan class=\"line-content\"\u003e  \u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e20\u003c/span\u003e\u003cspan class=\"line-content\"\u003e\u0026lt;/Target\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eTo summarise what\u0026#39;s happening here, when building in debug mode we are continuing to use the \u003ccode\u003enpm run build\u003c/code\u003e command to create a production build and the spa files get stored in the build folder \u003ccode\u003e$(SpaRoot)build\\**\u003c/code\u003e. The output looks like this:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebin\u003cul\u003e\n\u003cli\u003eRelease\u003cul\u003e\n\u003cli\u003epublish\u003cul\u003e\n\u003cli\u003eClientApp\u003cul\u003e\n\u003cli\u003ebuild\u003cbr\u003e-spa files go here!\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHowever in release mode we now create two versions of the spa (one for each environment) using out new npm environment builds, \u003ccode\u003enpm run build:staging\u003c/code\u003e and  \u003ccode\u003enpm run build:production\u003c/code\u003e. The builds also get moved to their corresponding folders.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebin\u003cul\u003e\n\u003cli\u003eRelease\u003cul\u003e\n\u003cli\u003epublish\u003cul\u003e\n\u003cli\u003eClientApp\u003cul\u003e\n\u003cli\u003estaging\u003cul\u003e\n\u003cli\u003estaging spa files go here!\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eproduction\u003cul\u003e\n\u003cli\u003eproduction spa files go here!\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOnce thats setup you can test it out with \u003ccode\u003edotnet publish --configuration Release\u003c/code\u003e, the build output should look something like this,\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"//images.ctfassets.net/wjg1udsw901v/6gBCaZH5bJ6vaNW2wf8QPD/7b1fcf59b5a716760ebf49c95aaaab85/BuildExample.png\" alt=\"build-output-spa\"\u003e\u003c/p\u003e\n\u003ch2\u003eModifying your startup.cs\u003c/h2\u003e\n\u003cp\u003eThe final step is to modify your Startup.cs file to switch out which spa to use based on the environment variable,\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs \"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e1\u003c/span\u003e\u003cspan class=\"line-content\"\u003eservices.AddSpaStaticFiles(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003econfiguration\u003c/span\u003e =\u0026gt;\u003c/span\u003e configuration.RootPath = WebHostEnvironment.IsDevelopment()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e2\u003c/span\u003e\u003cspan class=\"line-content\"\u003e                ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;ClientApp/build\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"code-line\"\u003e\u003cspan class=\"line-number\"\u003e3\u003c/span\u003e\u003cspan class=\"line-content\"\u003e                : $\u003cspan class=\"hljs-string\"\u003e\u0026quot;ClientApp/{WebHostEnvironment.EnvironmentName}\u0026quot;\u003c/span\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch1\u003eHow to deploy üöÄ\u003c/h1\u003e\n\u003cp\u003eDeployment is now a simple case of running \u003ccode\u003edotnet publish --configuration Release\u003c/code\u003e, once the published artefacts are deployed the app can now take its environment and run the appropriate spa. Build once and deploy anywhere!\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"$f\"}}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BreadcrumbList\\\",\\\"itemListElement\\\":[{\\\"@type\\\":\\\"ListItem\\\",\\\"position\\\":1,\\\"name\\\":\\\"Home\\\",\\\"item\\\":\\\"https://yourblog.com\\\"},{\\\"@type\\\":\\\"ListItem\\\",\\\"position\\\":2,\\\"name\\\":\\\"Blog\\\",\\\"item\\\":\\\"https://yourblog.com/blog\\\"},{\\\"@type\\\":\\\"ListItem\\\",\\\"position\\\":3,\\\"name\\\":\\\"Adding environments to ASP.NET Core with React.js SPA\\\",\\\"item\\\":\\\"https://yourblog.com/blog/aspnet-core-react-spa-adding-environments\\\"}]}\"}}],[\"$\",\"article\",null,{\"className\":\"page-module__dgei_G__article\",\"children\":[[\"$\",\"$L5\",null,{\"href\":\"/blog\",\"className\":\"page-module__dgei_G__backLink\",\"children\":\"‚Üê Back to Blog\"}],[\"$\",\"header\",null,{\"className\":\"page-module__dgei_G__header\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"page-module__dgei_G__title\",\"children\":\"Adding environments to ASP.NET Core with React.js SPA\"}],[\"$\",\"div\",null,{\"className\":\"page-module__dgei_G__meta\",\"children\":[\"$\",\"time\",null,{\"className\":\"page-module__dgei_G__date\",\"dateTime\":\"2021-01-19T00:00+00:00\",\"children\":[\"üìÖ \",\"January 19, 2021\"]}]}],[\"$\",\"div\",null,{\"className\":\"page-module__dgei_G__tags\",\"children\":[[\"$\",\"span\",\"react-0\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"react\"}],[\"$\",\"span\",\"spa-1\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"spa\"}],[\"$\",\"span\",\"asp.net-2\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"asp.net\"}],[\"$\",\"span\",\"dotnet core-3\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"dotnet core\"}],[\"$\",\"span\",\"environments-4\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"environments\"}],[\"$\",\"span\",\"env-cmd-5\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"env-cmd\"}],[\"$\",\"span\",\"shx-6\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"shx\"}],[\"$\",\"span\",\"template-7\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"template\"}],[\"$\",\"span\",\"msbuild-8\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\"msbuild\"}],[\"$\",\"span\",\".env-9\",{\"className\":\"page-module__dgei_G__tag\",\"children\":\".env\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"page-module__dgei_G__heroImage\",\"children\":[\"$\",\"$L10\",null,{\"src\":\"https://images.ctfassets.net/wjg1udsw901v/1IeybLQIjDnbaXTl4sbqTn/294b0ef4ad9095ee3633f6c38a0e35aa/hero.png\",\"alt\":\"Adding environments to ASP.NET Core with React.js SPA\",\"fill\":true,\"className\":\"page-module__dgei_G__heroImageImg\",\"priority\":true,\"sizes\":\"(max-width: 800px) 100vw, 800px\"}]}],[\"$\",\"div\",null,{\"className\":\"page-module__dgei_G__content\",\"dangerouslySetInnerHTML\":{\"__html\":\"$11\"}}]]}]]\n"])</script></body></html>